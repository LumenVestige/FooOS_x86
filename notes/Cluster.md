# FAT12 文件系统中的簇号（Cluster Number）

## 📚 什么是簇（Cluster）？

在 FAT 文件系统中，**簇（Cluster）** 是磁盘上的最小分配单元。每个簇由一个或多个扇区（Sector）组成。例如：

- 一个簇 = 1 个扇区 = 512 字节（常见）
- 或者一个簇 = 4 个扇区 = 2048 字节

文件系统不会按扇区分配文件，而是以簇为单位进行管理。这样做可以降低 FAT 表的大小并减少碎片。

---

## 🔢 什么是簇号（Cluster Number）？

每个簇在磁盘的数据区中都有一个编号，称为 **簇号（Cluster Number）**。

- FAT12 中簇号范围为：`2 ~ 4085`（因为 0 和 1 被保留）
- FAT 表中使用簇号来表示一个文件的 **数据簇链表**

---

## 🧵 簇链（Cluster Chain）示例

FAT 表类似于一个链表结构，用于串联文件的各个簇。例如：

| 簇号（Cluster） | 下一个簇号（FAT Entry） |
|------------------|------------------------|
| 2                | 5                      |
| 5                | 8                      |
| 8                | 0xFFF（文件结束）     |

> 表示一个文件的数据存储在簇 2 → 簇 5 → 簇 8。

---

## 📁 文件查找流程

1. **读取目录项（Directory Entry）**，获取文件的起始簇号。
2. **查 FAT 表**，找出下一个簇号，直到遇到结束标志（如 FAT12 中的 `0xFFF`）。
3. **按簇号从数据区读取数据块**，拼接成完整文件。

---

## 🧠 为什么要引入簇？

| 原因                   | 说明                                     |
|------------------------|------------------------------------------|
| 减少 FAT 表大小        | 若按 512 字节管理 1MB 需要 2048 项，太大 |
| 降低碎片率             | 大块写入可以减少碎片                    |
| 加快 FAT 查找速度       | 更少的项意味着更快的检索                |

---

## 📘 小结

| 术语    | 含义                                    |
|---------|-----------------------------------------|
| 扇区    | 磁盘的物理最小单位，通常为 512 字节      |
| 簇      | FAT 文件系统的最小逻辑单位（多个扇区）   |
| 簇号    | 数据区中每个簇的编号（从 2 开始）        |
| FAT 表  | 管理簇之间链接关系的表，类似链表结构      |

---

## 🔍 补充：常用 FAT12 特殊标记

| 值（FAT 表项） | 含义                     |
|----------------|--------------------------|
| `0x000`        | 空闲簇（Free）           |
| `0xFF7`        | 坏簇（Bad Cluster）      |
| `0xFFF`        | 文件结束（EOF）          |

---

如需图示或工具分析 FAT 镜像，可使用：

- `mtools`（如 `mdir -i boot.img ::`）
